{% extends "base.xml" %}
{% block content%}
<form id="disease_form">
	<field name="disease_field">
		<prompt>
			{% for disease_voice_label in diseases_voice_labels %}
			<audio src="{{ session.language.get_interface_voice_label_url_dict.pre_choice_option }}"/>
			<audio src="{{ disease_voice_label }}"/>
			<audio src="{{ session.language.get_interface_voice_label_url_dict.post_choice_option }}"/>
			{% for number in language.get_interface_numbers_voice_label_url_list %}{% if forloop.counter0 == forloop.parentloop.counter %}<audio src="{{ number }}"/>{% endif %}{% endfor %}
			{% endfor %}
		</prompt>

		{# all possible inputs from the user #}
		<grammar xml:lang="en-US" root = "MYRULE" mode="dtmf">
		      <rule id="MYRULE" scope = "public">
		        <one-of>
		          {% for option in choice_options %}
		            <item>{{ forloop.counter }}</item>
		          {% endfor %}
		        </one-of>
		       </rule>
		</grammar>

   {# when there has been input, save the corresponding URI in the given variable #}
   <filled>
    {% for disease in diseases %}
      {% if forloop.counter == 1 %}
      <if cond="disease_field == '{{ forloop.counter }}'">
		  <assign name="disease_id" expr="'{{ disease.id }}'"/>
      {% else %}
      <elseif cond="disease_field == '{{ forloop.counter }}'" />
      <assign name="disease_id" expr="'{{ disease.id }}'"/>
      {% endif %}
    {% endfor %}


    <else/>
    </if>

    <goto next="#amount_form"/>
  </filled>
 </field>
</form>

<form id="disease_amount_form">
{# Here the minimum and maximum number of digits to be entered are defined. The result is saved in a variable. #}
  <field name="disease_amount_field" type="digits?minlength=1;maxlength=7">
    <prompt>
    	<audio src="{{amount_voice_label}}"/>
    </prompt>
    <filled>
    {# saves the input to a variable with the name given, to be submitted later #}
   		<assign name="disease_amount" expr="disease_amount_field"/>
		{# forward the user to the given goto form #}
		<goto next="#submit_form"/>
    </filled>
  </field>
</form>


<form id="submit_form">
<block>
	{# include the variables in the dictionary 'pass_on_variables' as POST variables #}
	{% for key, value in pass_on_variables.items %}
	<assign name="{{ key }}" expr="'{{ value }}'"/>
	{% endfor %}
	<submit next="{{ redirect_url_POST }}" method="post" namelist="disease_id disease_amount {% for key, value in pass_on_variables.items %} {{ key }} {% endfor %}"/>
</block>
</form>


{% endblock %}
